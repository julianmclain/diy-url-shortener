service: diy-url-shortener
  
provider:
  name: aws  
  runtime: nodejs12.x  
  stage: ${file(config.json):STAGE}  
  region: ${file(config.json):REGION}  
  iamRoleStatements:
    - Effect: Allow      
      Action:
        - s3:PutObject
      Resource: "arn:aws:s3:::${file(config.json):BUCKET}/*"

functions:
  store:
    handler: api.handle
    events:
      - http:
          path: /
          method: post
          cors: true

resources:  
  Resources:    
    RedirectS3Bucket:
      Type: AWS::S3::Bucket     
      Properties:        
        BucketName: ${file(config.json):BUCKET}        
        AccessControl: PublicRead        
        WebsiteConfiguration:          
          IndexDocument: index.html    
    RedirectS3BucketPolicy:      
      Type: AWS::S3::BucketPolicy     
      Properties:        
        Bucket: ${file(config.json):BUCKET}        
        PolicyDocument:          
          Statement:          
            -
              Action:            
                - s3:GetObject            
              Effect: Allow            
              Resource:            
                - arn:aws:s3:::${file(config.json):BUCKET}/*            
              Principal: "*"
